<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  <title>Trail Breaker</title>

  <style media="screen">
    /* - - - - - G E N E R A L - - - - - - - - - */
    .body {
      background: #222;
      color: #fff;
      font-family: sans-serif;
      font-weight: 100;
      font-size: .6em;
      letter-spacing: 20;
      text-align: center;
      line-height: 2;
      overflow: hidden;
    }
    /* - - - - - R A N G É E S - - - - - - - - - */
    .X {
      display: flex;
    }
    /* - - - - - C A R R É S - É T E I N T S - - */
    .Y {
      width: 14px;
      height: 14px;
      background-color: #2a2a2a;
      border-radius: 5px;
      margin: 8px;
      transition: all .1s ease-out;
    }
    /* - - - - - C A R R É S - A L L U M É S - - */
    .active1,
    .active2,
    .pom {
      width: 22px;
      height: 22px;
      margin: 4px;
    }
    /* - - - - - C O U L E U R S - - - - - - - - */
    .active1 {
      background: yellow;
    }
    .active2 {
      background: cyan;
    }
    .active1.active2 {
      background-color: #fff;
    }
    .pom {
      background: #fff;
    }
    /* - - - - - C A R R É S - P E T I T S - - - */
    .Ynone {
      width: 0;
      height: 0;
      border-radius: 20px;
      margin: 15px;
    }
    /* - - - - - L E - J E U - - - - - - - - - - */
    .game {
      display: none;
      height: 100%;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    /* - - - - - L E - T E X T E - - - - - - - - */
    .title,
    .winner,
    .pressSpace {
      position: absolute;
      right: 0;
      left: 0;
      transition: all .25s ease-in-out;
    }
    .title {
      opacity: 1;
      top: 30vh;
    }
    .winner {
      opacity: 0;
      top: 30vh;
    }
    .pressSpace {
      opacity: 1;
      top: 60vh;
      color: #aaa;
    }
  </style>
</head>

<body class="body">

  <p class="title">TRAIL<br>BREAKER</p>
  <p class="winner"></p>
  <p class="pressSpace">PRESS SPACE</p>

  <div class="game"></div>

<!-- //////////////////////////////////////////////////////////////////////// -->

  <script type="text/javascript">
    var title, winner, pressSpace, game, gridWidth, gridHeight, tabX, tabY,
        active1, X1, Y1, snake1, maxLength1, dir1,
        active2, X2, Y2, snake2, maxLength2, dir2,
        pomX, pomY, maxLengthDefault, changedDir1, changedDir2,
        looping

    var Init = function() {
      title = document.querySelector('.title');
      winner = document.querySelector('.winner');
      pressSpace = document.querySelector('.pressSpace');
      game = document.querySelector('.game');

      gridWidth = 10;
      gridHeight = 10;

      for (var i = 0; i < gridHeight; i++) {
        game.innerHTML += "<div class='X'></div>";
      }
      tabX = document.querySelectorAll('.X');

      for (var i = 0; i < tabX.length; i++) {
        for (var i2 = 0; i2 < gridWidth; i2++) {
          tabX[i].innerHTML += "<div class='Y'></div>";
        }
      }
      tabY = document.querySelectorAll('.Y');
    }
    Init()


    var Reset = function() {
      maxLengthDefault = 5; //Taille de départ

      active1 = document.querySelectorAll('.active1');
      X1 = 4;
      Y1 = 0;
      snake1 = [tabY[Y1 + X1 * (tabY.length / tabX.length)]];
      maxLength1 = maxLengthDefault;
      dir1 = 'right';

      active2 = document.querySelectorAll('.active2');
      X2 = tabX.length - 5;
      Y2 = (tabY.length / tabX.length) - 1;
      snake2 = [tabY[Y2 + X2 * (tabY.length / tabX.length)]];
      maxLength2 = maxLengthDefault;
      dir2 = 'left';

      var pom = document.querySelector('.pom');
      if (pom !== null) {
        pom.classList.remove('pom');
      }
      pomX = Math.floor(Math.random() * tabX.length);
      pomY = Math.floor(Math.random() * (tabY.length / tabX.length));
      tabY[pomY + pomX * tabX.length].classList.add('pom');

      title.style.opacity = "0";
      winner.style.opacity = "0";
      winner.style.color = 'white';
      pressSpace.style.opacity = "0";
      game.style.display = "flex"; // Affiche le jeu

      EndAnim('off')

      RemoveClasses()


    }


    var EndAnim = function(turn) {
      if (turn === 'on') {
        for (var i = 0; i < tabY.length; i++) {
          tabY[i].style.transitionDuration = '.5s';
          tabY[i].style.transitionTimingFunction = 'ease-in-out';
          tabY[i].classList.add('Ynone');
        }
        document.querySelector('.pom').classList.remove('pom');
        winner.style.transitionDuration = '1.5s';
        pressSpace.style.transitionDuration = '1.5s';
      }
      else {
        for (var i = 0; i < tabY.length; i++) {
          tabY[i].style.transitionDuration = '';
          tabY[i].style.transitionTimingFunction = '';
          tabY[i].classList.remove('Ynone');
        }
        winner.style.transitionDuration = '';
        pressSpace.style.transitionDuration = '';
      }
    };



    var ResetChangedDir = function() {
      changedDir1 = 0;
      changedDir2 = 0;
    }

    var Events1 = function() {
      window.addEventListener('keyup', function(event) {
        if (event.which == 81 && dir1 != 'right' && changedDir1 == 0) {
          dir1 = 'left';
          changedDir1 = 1;
        }
        if (event.which == 68 && dir1 != 'left' && changedDir1 == 0) {
          dir1 = 'right';
          changedDir1 = 1;
        }
        if (event.which == 90 && dir1 != 'bottom' && changedDir1 == 0) {
          dir1 = 'top';
          changedDir1 = 1;
        }
        if (event.which == 83 && dir1 != 'top' && changedDir1 == 0) {
          dir1 = 'bottom';
          changedDir1 = 1;
        }
      });
    }

    var Events2 = function() {
      window.addEventListener('keyup', function(event) {
        if (event.which == 37 && dir2 != 'right' && changedDir2 == 0) {
          dir2 = 'left';
          changedDir2 = 1;
        }
        if (event.which == 39 && dir2 != 'left' && changedDir2 == 0) {
          dir2 = 'right';
          changedDir2 = 1;
        }
        if (event.which == 38 && dir2 != 'bottom' && changedDir2 == 0) {
          dir2 = 'top';
          changedDir2 = 1;
        }
        if (event.which == 40 && dir2 != 'top' && changedDir2 == 0) {
          dir2 = 'bottom';
          changedDir2 = 1;
        }
      });
    }

    var Move1 = function() {
      if (dir1 === 'left') {
        if (Y1 % (tabY.length / tabX.length) == 0) {
          Y1 += (tabY.length / tabX.length) - 1;
        } else {
          Y1 -= 1;
        }
      }
      if (dir1 === 'right') {
        if ((Y1 + 1) % (tabY.length / tabX.length) == 0) {
          Y1 -= (tabY.length / tabX.length) - 1;
        } else {
          Y1 += 1;
        }
      }
      if (dir1 === 'top') {
        if (X1 === 0) {
          X1 += tabX.length - 1;
        } else {
          X1 -= 1;
        }
      }
      if (dir1 === 'bottom') {
        if (X1 === tabX.length - 1) {
          X1 -= tabX.length - 1;
        } else {
          X1 += 1;
        }
      }
    }

    var Move2 = function() {
      if (dir2 === 'left') {
        if (Y2 % (tabY.length / tabX.length) == 0) {
          Y2 += (tabY.length / tabX.length) - 1;
        } else {
          Y2 -= 1;
        }
      }
      if (dir2 === 'right') {
        if ((Y2 + 1) % (tabY.length / tabX.length) == 0) {
          Y2 -= (tabY.length / tabX.length) - 1;
        } else {
          Y2 += 1;
        }
      }
      if (dir2 === 'top') {
        if (X2 === 0) {
          X2 += tabX.length - 1;
        } else {
          X2 -= 1;
        }
      }
      if (dir2 === 'bottom') {
        if (X2 === tabX.length - 1) {
          X2 -= tabX.length - 1;
        } else {
          X2 += 1;
        }
      }
    }

    var UpdateSnake = function() {
      // SAUVEGARDE POSITION ACTUELLE
      snake1.push(tabY[Y1 + X1 * (tabY.length / tabX.length)]);
      snake2.push(tabY[Y2 + X2 * (tabY.length / tabX.length)]);
      // CHANGE POSITION TETE
      snake1[snake1.length - 1].classList.add('head1')
      snake2[snake2.length - 1].classList.add('head2')
      // SUPPRIME LE DERNIER BOUT
      if (snake1.length > maxLength1) {
        snake1.shift();
      }
      if (snake2.length > maxLength2) {
        snake2.shift();
      }
    }

    var CheckCollide = function() {
      var collisionSelf1 = document.querySelector('.head1.active1');
      var collisionOpp1 = document.querySelector('.head1.active2');
      var collisionSelf2 = document.querySelector('.head2.active2');
      var collisionOpp2 = document.querySelector('.head2.active1');
      var headtohead = document.querySelector(".head1.head2");
      if (((collisionSelf1 !== null || collisionOpp1 !== null) && (collisionSelf2 !== null || collisionOpp2 !== null)) || headtohead !== null) {
        console.log('DRAW');
        EndAnim('on');
        winner.style.opacity = "1";
        winner.textContent = '- draw -';
        pressSpace.style.opacity = "1";
        window.clearInterval(looping);
      } else {
        if (collisionSelf1 !== null) {
          console.log('J1|J1');
          EndAnim('on');
          winner.style.opacity = "1";
          winner.textContent = '- p2 wins -';
          winner.style.color = 'cyan';
          pressSpace.style.opacity = "1";
          window.clearInterval(looping);
        }
        if (collisionOpp1 !== null) {
          console.log('J1|J2');
          EndAnim('on');
          winner.style.opacity = "1";
          winner.textContent = '- p2 wins -';
          winner.style.color = 'cyan';
          pressSpace.style.opacity = "1";
          window.clearInterval(looping);
        }
        if (collisionSelf2 !== null) {
          console.log('J2|J2');
          EndAnim('on');
          winner.style.opacity = "1";
          winner.textContent = '- p1 wins -';
          winner.style.color = 'yellow';
          pressSpace.style.opacity = "1";
          window.clearInterval(looping);
        }
        if (collisionOpp2 !== null) {
          console.log('J2|J1');
          EndAnim('on');
          winner.style.opacity = "1";
          winner.textContent = '- p1 wins -';
          winner.style.color = 'yellow';
          pressSpace.style.opacity = "1";
          window.clearInterval(looping);
        }
      }
    }

    CheckApple1 = function() {
      var eat1 = document.querySelector('.head1.pom');
      if (eat1 !== null) {
        maxLength1 += 2;
        eat1.classList.remove('pom');
        var pomX = Math.floor(Math.random() * tabX.length);
        var pomY = Math.floor(Math.random() * (tabY.length / tabX.length));
        tabY[pomY + pomX * tabX.length].classList.add('pom');
      }
    }
    CheckApple2 = function() {
      var eat2 = document.querySelector('.head2.pom');
      if (eat2 !== null) {
        maxLength2 += 2;
        eat2.classList.remove('pom');
        var pomX = Math.floor(Math.random() * tabX.length);
        var pomY = Math.floor(Math.random() * (tabY.length / tabX.length));
        tabY[pomY + pomX * tabX.length].classList.add('pom');
      }
    }

    var RemoveClasses = function() {
      active1 = document.querySelectorAll('.active1');
      for (var i = 0; i < active1.length; i++) {
        active1[i].classList.remove('active1');
      }
      active2 = document.querySelectorAll('.active2');
      for (var i = 0; i < active2.length; i++) {
        active2[i].classList.remove('active2');
      }
      head1 = document.querySelectorAll('.head1');
      for (var i = 0; i < head1.length; i++) {
        head1[i].classList.remove('head1');
      }
      head2 = document.querySelectorAll('.head2');
      for (var i = 0; i < head2.length; i++) {
        head2[i].classList.remove('head2');
      }
    }

    var DispSnakes = function() {
      for (var i1 = 0; i1 < snake1.length; i1++) {
        snake1[i1].classList.add('active1');
      }
      for (var i2 = 0; i2 < snake2.length; i2++) {
        snake2[i2].classList.add('active2');
      }
    }

    var loop = function() {

      ResetChangedDir()

      Events1()
      Events2()

      Move1()
      Move2()

      UpdateSnake()

      CheckCollide()

      CheckApple1()
      CheckApple2()

      RemoveClasses()

      DispSnakes()
    }


    // PRESS SPACE

    window.addEventListener('keyup', function(event) { //BOUTON ESPACE!!!
      if (event.which === 32) {

        Reset()

        window.clearInterval(looping);
        looping = window.setInterval(loop, 100);

        DispSnakes()
      }
    });
  </script>
</body>

</html>
